## ebs
- 네트워크 드라이브이며 하나의 인스턴스와 연결
- az(availability zone)끼리 전송 가능(스냅샷을 찍고 다른 영역에 복원)
- 볼륨 조절 가능
- 최대 처리량을 지정할 수 있음
- 볼륨 유형
    - gp2/gp3 (ssd): 좋은 가격과 선응의 균형. 워크로드에 적합
    - io1/ io2(ssd) / io2 block express: 성능이 높고 처리량도 높으면서 레이턴시도 짧길 원하면 적합
    - st l(hdd): 비용이 낮은 hdd 필요시 적합. 자주 액세스시 유용
    - sc l(hdd): 비용이 낮은 hdd 필요시 적합. 자주 액세스하지 않으면 유용
    - gp2/gp3/io l/ io2만 부팅 볼륨 측면에서 사용 가능
- 스냅샷
    - 변경된 블록만 백업
    - 백업은 io를 사용하기에, 앱이 많은 트래픽 사용시 백업이 안될 수도 있음
    - s3에 저장됨 (하지만 다이렉트로 볼 수는 없음)
    - 볼륨을 분리할 필요는 없지만, 안정성 때문에 권장됨
- amazon data lifecycle manager
    - 자동으로 ebs 스냅샷에 대해서 생성, 유지, 삭제 작업을 해줌
    - resource tag를 통해서 ec2, ebs 와 같이 어떤 리소스를 쓴느지 식별 
    - dlm 바깥에서 생성된 스냅샷은 관리 불가
    - backup과의 차이
        - backup은 모든 서비스를 한 곳에서 관리, lifecycle은 선택 가능
- 암호화
    - 디폴트는 암호화되지 않음
    - 킬 경우 볼륨과 스냅샷이 자동으로 암호화 / 리전별로 설정
- 다중 연결
    - io1 io2만 사용 가능
    - 여러 e2 인스턴스에 동일한 ebs 볼륨을 연결
    - 각 인스턴스는 full read write 권한을 얻음
    - 특정 종류의 앱을 위한 기능 (teradata와 같은 높은 가용성)
    - 파일 시스템은 클러스터 인식 파일 시스템
- local ec2 instance store
    - 물리적 디스크로, ec2가 있는 물리적 서버에 연결
    - 높은 iops (디스크가 ec2랑 연결되어있기에)
    - ec2 종료시 데이터 손실, 용량 확대 불가, 블록 스토리지
    - reboot는 살아남음
    - EBS와 차이
        - ebs는 영구, 인스턴스는 임시
        - 장점: 인스턴스는 io 성능이 높음 / 버퍼 캐시 임시_콘텐츠에도 좋음
        - 단점: 크기 조절 불가 / 백업 필요 / 종료시 데이터 삭제

## efs
- elastic file system
- nfs(network file system)으로 관리되기에 여러 EC2에 마운트 가능
- 동일한 리전이고 다른 가용 영역의 ec2와 협업 가능
- 가용성이 높지만 비쌈
- 콘텐츠 관리, 웹 데이터 제공, wordpress 등에 사용
- linux 기반 ami가 필요, window는 불가 / posix와 호환되어야함
- nfs4.1 프로토콜 사용. 
- kms를 이용해 암호화, 하나의 vp에만 연결 가능
- 규모
    - 1000개 시앙의 클라와, 10GB의 동시성 가능
    - pb 규모의 파일 시스템으로 자동 확장 가능
- 성능 모드(efs 생성 시간 시에 결정)
    - 기본: 응답시간에 민감한 경우 (웹, cms 등)
    - max i/o: 응답시간은 길지만, 처리량 극대화 (big data, 미디어 processing)
- 처리량 모드
    - 버스팅: 1tb: 초당 50mib + 최대 100mib 버스트가 더해짐
    - 프로비저닝: 스토리지 용량과 무관하게 처리량 설정: 1gib/s for 1 tb storage
    - 탄력적: 워크로드에 따라서 자동으로 설정됨
- storage classes
    - storage tiers 설정
        - 60일이 지나도 액세스되지 않으면 standard에서 IA 티어로 이동
    - 가용성 내구성
        - regional: 멀티 영역. 디폴트 값
        - one zone efs: 단일 가용 영역. dev, backup으로 적합. 비용에 적게 듦
- on-premise
    - 온프레미스 서버에 마운트 가능, vpc 피어링도 있음

## s3
- 제한 없는 저장소. 정적 콘텐츠 저장에 유리
- 키를 통해서 액세스, 인덱스 기능은 없음
- 파일 시스템이 아님. EC2에 마운트 불가
- 안티 패턴
    - 작은 파일이 많으면 안좋음
    - posix 파일 시스템 (파일 시스템은 s3 대신에 EFS 사용 권장)
    - 파일 잠금 없음, 검색 기능 없음, 쿼리 없음
    - 동적 콘텐츠인 웹에도 안좋음
- 수명 주기를 통해 티어 간에 객체 전환 or 삭제 가능
- 복제 기능 지원
    - CRR(cross region replication)
        - 한 리전의 s3 버킷이 다른 리전으로 복제
    - SRR(Same Region Replication)
        - 같은 리전으로 복제
    - 복제는 티어를 고려하지 않음. 타겟에서 직접 티어와 수명 주기를 관리해야함
    - S3 RTC(replication time control) 기능
        - 업로드하는 객체가 몇초 만에 복제되고 99.99%가 15분 내로 복제되도록 보장
- event notification
    - ObhectCreated, ObjectRemoved, ObjectRestore, Replication 기능 지원
    - 객체 이름으로 필터링도 가능
    - 업로드된 이미지에 대해서 섬네일 자동 생성 등에 이용됨
    - 원하는 만큼 이벤트 생성 가능, 1분 이상 걸릴때도 있음
    - SNS, SQS, 람다로 트리거 가능
    - eventbridge와 이벤트를 공유함 (설정 가능) 
        - 18개가 넘는 서비스 대상으로 보낼 수 있음
        - json 규칙으로 고급 필터링 규칙 설정 가능
        - 일단벅인 notification에서 못한 metadata, size, name 등도 가능
        - 한 규칙에 대해서 여러 목적지로 보낼 수도 있음
        - 아카이브 기능에 대한 가시성을 높힐 수가 있음
- 성능 (perfromance)
    - 높은 속도로 자동으로 확장, 접근성은 100ms
    - 초당 5500개의 get head요청 가능/ 초당 3500개의 put/copy/post/del 가능
    - bucket에 prefix 길이 제한이 없음 (bucket/folder1/sub1/file 등)
    - multipart upload
        - 100mb 이상일때 권장, 5gb 이상이면 필수
        - 파일을 여러부분으로 분리
    - s3 transfer acceleration (업로드만)
        - 타겟 리전의 s3 버킷으로 데이터 전달 시, aws edge location으로 먼저 전송해 속도 높힘
        - 멀티파트 업로드와 결합 가능
    - s3 byte-range fetches
        - 파일 수신시 byte 단위로 쪼개서 get을 병렬화
        - get 하나가 실패해도 복원력이 높음
        - 다운로드 속도 증가에 사용
        - 부분 데이터 검색에도 사용 (헤드 같은 것들)
            - 파일 헤드는 첫 바이트만 의미하므로 쉽게 찾을 수 있음
    - remove incomplete part
        - 수명 주기 정책을 이용해 불완전한 multi part 파일이 있을 경우 X일 이후로 삭제되도록 설정
    - s3 & glacier select
        - sql을 이용해 서버측의 필터링해 더 적은 데이터를 검색
        - 행과 열로만 필터링 가능
- storage class 분석
    - 객체를 올바른 스토리지 클래스로 전환해야 할 시점을 알려줌
    - standard, standard IA로 전환하는 것에 대한 추천
    - 매일 보고되며, 분석하는데 24-48시간이 필요
    - quicksight에서 데이터 시각화 가능
- storange lens
    - 조직 전반에서 스토리지를 분석하고 최적화
    - 이상치를 발견, 비용 효율성 식별, 30일 사용량 분석
    - 보고서는 csv or parquet 형식으로 내보낼 수도 있음
    - 조직과 계정 리전 버킷을 모두 고려해 보고서로 집계하고 분석에 도움을 줌
    - defualt dashboard
        - 여러 리전과 여러 계정의 데이터를 보여줌
        - s3에서 미리 구성하며, 기본 대시보드는 삭제할 수는 없고 비활성화는 가능
    - fess vs paid
        -  프리는 쿼리 기간이 14일, 28개의 메트릭스 제공
        - 유료는 고급 데이터 보호, 상태 코드, cloudwatch에 게시 지원, 접두사 수준으로 지표 수집 가능
- exposing static object
    - 정적 객체를 클라에 제공하는 방법
    - 간단한 방법은 EC2 instance에 데이터 저장
    - cloudfront -> EC2 -> EBS 순으로 이동하기
        - global edge network를 통해 캐시에 저장되어 객체를 좀더 가까이 둘 수 있음
        - 글로벌 가용성이 더 나음
        - 실패시 cloudfront가 보고
    - cloudfront -> ALB -> ASG(오토 스케일링 그룹) -> EFS 순으로 이동하기
        - 데이터를 공유하고 같은 파일에 대해 액세스 권한이 있어야하므로 EBS보단 EFS 사용
        - 비쌈
    - cloudfront -> S3
        - 큰 정적 개체가 있는 경우 유리
- DynamoDB
    - s3에서 인덱싱 기능은 없으므로 dynamoDB에서 개체를 인덱싱
    - lambda function을 이용해 파일의 일부를 읽고 
    - dynamoDB 테이블에 정보 삽입
    - 그 테이블에서 검색하는 api 생성 가능

## FSx
- 3rd 파티 고성능 '파일 시스템'을 실행 가능
- 완전 관리형 서비스
- lustre, window file server, netapp on tap, openzfs 실행 간으
- window file server
    - wondows 파일 시스템 공유 드라이브
    - smb 프로토콜과 window ntfs 지원
    - microsoft active directory 통합 지원
    - linux ec2 인스턴스에 마운트 가능
    - 온프레미스에 있다면 distributed file system을 이용해서 파일 시스템 그룹화 가능
    - 저장 옵션
        - ssd 짧은 접근성
        - HDD 광범위 스팩트럼 지원
- amazon fsx for lustre
    - 분산 파일 시스템
    - lustre는 linux + cluster
    - 높은 성능 컴퓨팅에 사용 (ml 등)
    - 저장 옵션으로 ssd hdd가 존재
    - s3와 원활하게 통합, s3를 읽을 수 있음
- file system 배포 옵션
    - 스크래치 파일 시스템
        - 임시 스토리지
        - 복제되지 않아 서버 에러시 복구가 힘듦
        - 단기 프로세싱, 최적화 코스트에 사용
    - 영구 파일 시스템
        - 장기 스토리지
        - 동일한 az에 복자됨
        - 장기 처리 및 데이터 저장
- netapp ontap
    - nfs, smb, iscsi 프로토콜과 호환 됨
    - 스토리지가 자동으로 확장 및 축소
    - 순간 클론을 복제해 실행 가능해서 새로운 워크로드 테스트에 유리함
- openzfs
    - 여러 버전의 nfs 프로토콜과만 호환
    - 내부적으로 zfs에서 실행되는 워크로드를 aws로 이동
    - 순간 클론을 복제해 실행 가능해서 새로운 워크로드 테스트에 유리함

## datasync
- 데이터를 이동할때 사용 (온프레미스, 다른 aws 클라우드 등)- agent 필요
- aws 서비스 간 이동은 agent 미필요
- 파일 권한과 매타데이터(보안 등)를 보존
- 매일 매주 매시간 스케쥴 설정 가능
- 하나의 에이전트는 10gb/s 사용 가능, 대역폭 제한 설정 가능
- 온프레미스 -> aws (NFS/ SMB 사용)
     - 온프레미스에는 datasync agent, aws에는 datasync 설치 필요
     - 온프레미스가 datasync agent에게 nfs/smb 요청을 하고 agent는 aws datasync에 요청해서 서로 통신
     - 용량 부족시에 snowcone을 설치해서 datasync agnet를 미리 설치할 수도 있믕

## transfer family
- s3나 efs 안밖으로 데이터 전송에 사용
- s3 api/efs 미사용을 통한 전송을 원하면 사용하면 됨
- 프로토콜은 FTP, FTPS, SFTP를 지원
- 